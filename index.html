<html>
<head>
<script src="vector.js"></script>
<script src="objects.js"></script>
<style>
body, html {margin: 0;}
canvas {background-color: black;}
</style>
</head>
<body>
    <canvas id = "canv", width="1000px", height="1000px">
    </canvas>
</body>

<script>
    var canv = document.getElementById("canv");
    var ctx = canv.getContext("2d");

    ctx.strokeStyle = "white";
    var world = new World(ctx, canv);
    world.dT = 0.2;

    //var p1 = world.addObject( new Dot(new Vector(50,50), 1) );
    //var p2 = world.addObject( new Dot(new Vector(100,50), 1) );
    //var p3 = world.addObject( new Dot(new Vector(100,100), 1) );
    //world.addObject( new Spring(p1, p2, 80) );
    //world.addObject( new Spring(p1, p3 ) );
    //world.addObject( new Spring(p2, p3 ) );

    dots = [];
    springs = [];
    randomizeLastSpringLength = (max, min = 0) => {
                springs[springs.length - 1].distance += Math.random()*max-Math.random()*min
    }
    for (var j = 0; j < 30; j++) {
        dots.push([]);
        for (var k = 0; k < 30; k++){
            dots[j].push(world.addObject( new Dot( new Vector( (j+1)*15,(k+1)*15) ) ) );
            if(k > 0) {
                springs.push( new Spring(
                    dots[j][k],
                    dots[j][k-1]
                ) )
                randomizeLastSpringLength(0);
            }
            if(j > 0) {
                springs.push( new Spring(
                    dots[j-1][k],
                    dots[j][k]
                ) )
                randomizeLastSpringLength(0);
            }
        }
    }

    springs.map( o => world.addObject(o) );
    dots.map( o => o.map( o => world.addObject(o) ) );

function loop () {
        //todo set world.dT according to time passed since last frame (as I have no guarantee how often requestAnimationFrame is allowed to execute at a time).
        world.update();
        window.requestAnimationFrame(loop);
    }
    window.requestAnimationFrame(loop);
    
</script>
</html>
